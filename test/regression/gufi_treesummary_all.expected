$ gufi_treesummary_all --help
usage: gufi_treesummary_all [options] GUFI_tree
options:
  -h, --help                        help
  -H, --debug                       show assigned input values (debugging)
  -v, --version                     version
  -n, --threads <threads>           number of threads
      --min-level <min level>       minimum level to go down
      --max-level <max level>       maximum level to go down
      --path-list <filename>        File containing paths at single level to index (not including starting path). Must also use --min-level
      --dont-reprocess              if a directory was previously processed, skip descending the subtree
      --suspect-time <s>            time in seconds since epoch for suspect comparision

GUFI_tree                path to GUFI tree


# Start with no treesummary tables
$ gufi_query -d " " -S "SELECT '' FROM tree.sqlite_master WHERE (type == 'table') AND (name == 'treesummary');" -E "SELECT rpath(sname, sroll) FROM vrsummary WHERE isroot == 1;" "prefix"


# Generate treesummary tables in some directories at level 1
$ gufi_treesummary_all --min-level 1 --path-list "path_list" "prefix"

# Query treesummary tables
$ gufi_query -d " " -T "SELECT rpath(s.sname, s.sroll), t.totsubdirs, t.maxsubdirfiles, t.maxsubdirlinks, t.totfiles, t.totlinks FROM treesummary AS t, vrsummary as s;" "prefix"
prefix/directory 1 3 1 4 1
prefix/directory/subdirectory 0 1 1 1 1
prefix/leaf_directory 0 2 0 2 0


# Generate treesummary tables in all directories at level 1
$ gufi_treesummary_all --min-level 1 "prefix"

# Query treesummary tables
$ gufi_query -d " " -T "SELECT rpath(s.sname, s.sroll), t.totsubdirs, t.maxsubdirfiles, t.maxsubdirlinks, t.totfiles, t.totlinks FROM treesummary AS t, vrsummary as s;" "prefix"
prefix/directory 1 3 1 4 1
prefix/directory/subdirectory 0 1 1 1 1
prefix/empty_directory 0 0 0 0 0
prefix/leaf_directory 0 2 0 2 0
prefix/unusual#? directory , 0 1 0 1 0


# Generate treesummary tables in all directories
$ gufi_treesummary_all "prefix"

# Query treesummary tables
$ gufi_query -d " " -T "SELECT rpath(s.sname, s.sroll), t.totsubdirs, t.maxsubdirfiles, t.maxsubdirlinks, t.totfiles, t.totlinks FROM treesummary AS t, vrsummary as s;" "prefix"
prefix 5 5 1 12 2
prefix/directory 1 3 1 4 1
prefix/directory/subdirectory 0 1 1 1 1
prefix/empty_directory 0 0 0 0 0
prefix/leaf_directory 0 2 0 2 0
prefix/unusual#? directory , 0 1 0 1 0


# Generate treesummary tables if they don't already exist
$ gufi_treesummary_all --dont-reprocess "prefix"

# Create a fresh tree without treesummary tables
$ gufi_dir2index -n 2 "prefix" "search"
Creating GUFI Index search with 2 threads
Total Dirs:          6
Total Non-Dirs:      14

# Use --suspect-time with a future timestamp on the new index
$ gufi_treesummary_all --suspect-time 2147483646 "search"

# treesumary table was not created
$ sqlite3 "search/db.db" ".tables"
entries              summary              vsummarygroup
external_dbs         summarylong          vsummaryuser
external_dbs_pwd     vrpentries           xattrs_avail
external_dbs_rollup  vrsummary            xattrs_pwd
pentries             vrsummarylong        xattrs_rollup
pentries_rollup      vsummarydir

# Use --suspect-time with a past timestamp
$ gufi_treesummary_all --suspect-time 0 "search"

# treesumary table was created
$ sqlite3 "search/db.db" ".tables"
entries              summarylong          vsummaryuser
external_dbs         treesummary          vtsummarydir
external_dbs_pwd     vrpentries           vtsummarygroup
external_dbs_rollup  vrsummary            vtsummaryuser
pentries             vrsummarylong        xattrs_avail
pentries_rollup      vsummarydir          xattrs_pwd
summary              vsummarygroup        xattrs_rollup

# Missing db.db
$ gufi_treesummary_all "search"
Cannot open database: search/db.db unable to open database file rc 14

# Multiple paths with --min-level and --path-list
$ gufi_treesummary_all --min-level 1 --path-list path_list "search" "search"
Error: Only one root may be provided when a --min-level and -D are both provided

