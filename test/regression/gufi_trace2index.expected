# gufi_trace2index help
$ gufi_trace2index
usage: gufi_trace2index [options] trace_file... output_dir
options:
  -h                     help
  -H                     show assigned input values (debugging)
  -n <threads>           number of threads
  -d <delim>             delimiter (one char)  [use 'x' for 0x1E]
  -M <bytes>             target memory footprint

trace_file...     parse one or more trace files to produce the GUFI index
output_dir        build GUFI index here


$ generatetree prefix

$ gufi_dir2trace -d "|" -n 2 -x "prefix" "trace"
Creating GUFI Traces trace with 2 threads
Total Dirs:          6
Total Files:         14

$ gufi_trace2index -d "|" trace "search"
Creating GUFI Index search with 1 threads
Dirs:                6 (1 empty)
Files:               14
Total:               20

Total Dirs:          6
Total Files:         14

Source Directory:
    prefix
    prefix/.hidden
    prefix/1KB
    prefix/1MB
    prefix/directory
    prefix/directory/executable
    prefix/directory/readonly
    prefix/directory/subdirectory
    prefix/directory/subdirectory/directory_symlink
    prefix/directory/subdirectory/repeat_name
    prefix/directory/writable
    prefix/empty_directory
    prefix/file_symlink
    prefix/leaf_directory
    prefix/leaf_directory/leaf_file1
    prefix/leaf_directory/leaf_file2
    prefix/old_file
    prefix/repeat_name
    prefix/unusual#? directory ,
    prefix/unusual#? directory ,/unusual, name?#

GUFI Index:
    prefix
    prefix/.hidden
    prefix/1KB
    prefix/1MB
    prefix/directory
    prefix/directory/executable
    prefix/directory/readonly
    prefix/directory/subdirectory
    prefix/directory/subdirectory/directory_symlink
    prefix/directory/subdirectory/repeat_name
    prefix/directory/writable
    prefix/empty_directory
    prefix/file_symlink
    prefix/leaf_directory
    prefix/leaf_directory/leaf_file1
    prefix/leaf_directory/leaf_file2
    prefix/old_file
    prefix/repeat_name
    prefix/unusual#? directory ,
    prefix/unusual#? directory ,/unusual, name?#

# create index with a directory containing a lot of files 
$ gufi_trace2index -d "|" big.dir.trace "big.dir.index"
Creating GUFI Index big.dir.index with 1 threads
Dirs:                1 (0 empty)
Files:               100001
Total:               100002

Total Dirs:          1
Total Files:         100001

$ gufi_query -d " " -E "SELECT COUNT(*) FROM entries;" "big.dir.index/prefix"
100001

# create index from a trace file whose last item is an empty directory
$ gufi_trace2index -d "|" -n 2 "empty_last_dir.trace" "search"
Creating GUFI Index search with 2 threads
Dirs:                7 (2 empty)
Files:               14
Total:               21

Total Dirs:          7
Total Files:         14

# bad trace path
$ gufi_trace2index -d "|" -n 2 "" "search"
Could not open "": No such file or directory (2)
Failed to open trace file for each thread

# bad index path
$ gufi_trace2index -d "|" -n 2 "trace" "prefix/1KB" 2> >(sort)
Could not create directory prefix/1KB


# empty trace
$ gufi_trace2index -d "|" -n 2 "badtrace" "search"
Could not get the first line of trace "badtrace"
Creating GUFI Index search with 2 threads
Dirs:                0 (0 empty)
Files:               0
Total:               0

Total Dirs:          0
Total Files:         0


# cannot find delimiter of first line
$ gufi_trace2index -d "?" -n 2 "trace" "search"
Could not find the specified delimiter in "trace"
Creating GUFI Index search with 2 threads
Dirs:                0 (0 empty)
Files:               0
Total:               0

Total Dirs:          0
Total Files:         0


# first line does not start with a directory
$ gufi_trace2index -d "|" -n 2 "badtrace" "search"
First line of "badtrace" is not a directory
Creating GUFI Index search with 2 threads
Dirs:                0 (0 empty)
Files:               0
Total:               0

Total Dirs:          0
Total Files:         0


# badtrace:
$ cat "badtrace"
prefix|d|0|0|0|0|0|0|0|0|0|0|0|||0|0|0|0|0|||0|
prefix/1KB?f?

# file delimiter not found
$ gufi_trace2index -d "|" -n 2 "badtrace" "search"
Scout encountered bad line ending at "badtrace" offset 62
Creating GUFI Index search with 2 threads
Dirs:                0 (0 empty)
Files:               0
Total:               0

Total Dirs:          0
Total Files:         0

# bad thread count
$ gufi_dir2trace -n 18446744073709551615 "prefix" "trace"
Could not allocate space for 18446744073709551615 files

